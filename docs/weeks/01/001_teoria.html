<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Semana 1: Arquitectura Blazor Server</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&family=Fira+Code:wght@400&display=swap" rel="stylesheet">
    <!-- Mermaid JS for Diagrams -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <!-- Highlight.js for Code Highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/tokyo-night-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/csharp.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/xml.min.js"></script>
    <script>hljs.highlightAll();</script>
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f8f9fa;
            color: #333;
        }
        h1, h2, h3 {
            color: #512bd4; /* Blazor Purple */
            font-weight: 700;
        }
        .header-banner h1 {
            color: white;
        }
        .header-banner {
            background: linear-gradient(135deg, #512bd4 0%, #3a1c99 100%);
            color: white;
            padding: 3rem 0;
            margin-bottom: 2rem;
            border-bottom: 5px solid #00bcd4;
        }
        .code-block {
            background-color: #2d2d2d;
            color: #f8f8f2;
            padding: 1.5rem;
            border-radius: 8px;
            font-family: 'Fira Code', monospace;
            font-size: 0.9rem;
            position: relative;
            margin-bottom: 1.5rem;
        }
        .concept-card {
            background: white;
            border-left: 5px solid #512bd4;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border-radius: 4px;
        }
        .file-structure ul {
            list-style-type: none;
        }
        .file-structure li::before {
            content: "üìÑ ";
        }
        .file-structure li.folder::before {
            content: "üìÅ ";
        }
        .important-note {
            background-color: #e3f2fd;
            border-left: 5px solid #2196f3;
            padding: 1rem;
            margin: 1rem 0;
        }
        footer {
            margin-top: 3rem;
            padding: 2rem 0;
            background-color: #343a40;
            color: white;
            text-align: center;
        }
    </style>
</head>
<body>

    <!-- Header -->
    <header class="header-banner">
        <div class="container">
            <h1 class="display-4">Lenguaje de Programaci√≥n III</h1>
            <p class="lead">Semana 1: Introducci√≥n a la Arquitectura Blazor Server</p>
            <div class="d-flex gap-3">
                <span class="badge bg-info text-dark">IRI-005</span>
                <span class="badge bg-warning text-dark">Teor√≠a</span>
                <span class="badge bg-light text-dark">.NET 8</span>
            </div>
        </div>
    </header>

    <div class="container">

        <!-- Secci√≥n 1: El Problema y la Soluci√≥n -->
        <section class="mb-5">
            <h2>1. ¬øQu√© es Blazor Server?</h2>
            <p class="lead">Blazor nos permite construir interfaces web interactivas usando <strong>C# en lugar de JavaScript</strong>.</p>
            
            <div class="row mt-4">
                <div class="col-md-6">
                    <div class="concept-card">
                        <h4>üñ•Ô∏è Server-side Rendering (SSR)</h4>
                        <p>La l√≥gica se ejecuta en el <strong>servidor</strong>. El cliente recibe HTML procesado por el servidor. En Blazor Server, esto ocurre en tiempo real v√≠a SignalR, proporcionando una carga inicial veloz.</p>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="concept-card">
                        <h4>üíª Client-side Rendering (CSR)</h4>
                        <p>La l√≥gica se descarga y ejecuta directamente en el <strong>navegador</strong> del usuario (usando WebAssembly en Blazor). El cliente tiene el control total, permitiendo aplicaciones Offline y menor latencia en la UI.</p>
                    </div>
                </div>
            </div>

            <div class="card mt-3">
                <div class="card-header bg-dark text-white">Arquitectura: El Circuito SignalR</div>
                <div class="card-body text-center">
                    <div class="mermaid">
                        graph LR
                            Browser["üåê Navegador (Cliente)"] -- "Eventos UI (Click)" --> SignalR["üì° SignalR (WebSocket)"]
                            SignalR -- "Procesa C#" --> Server["üñ•Ô∏è Servidor (.NET Core)"]
                            Server -- "Diferencias DOM (Render Tree)" --> SignalR
                            SignalR --> Browser
                    </div>
                    <p class="text-muted mt-2"><small>Diagrama de comunicaci√≥n en tiempo real</small></p>
                </div>
            </div>
        </section>

        <!-- Secci√≥n 2: Estructura del Proyecto -->
        <section class="mb-5">
            <h2>2. Anatom√≠a de un Proyecto .NET 8</h2>
            <p>Al crear un proyecto Blazor Web App, esta es la estructura que encontraremos. Es vital entender d√≥nde va cada cosa.</p>

            <div class="row">
                <div class="col-md-5">
                    <div class="concept-card file-structure">
                        <h5>üìÇ Estructura de Archivos</h5>
                        <ul>
                            <li class="folder"><strong>Properties/launchSettings.json</strong>: Configura puertos y perfiles.</li>
                            <li class="folder"><strong>wwwroot</strong>: CSS, Im√°genes, JS est√°tico.</li>
                            <li class="folder"><strong>Components</strong>
                                <ul>
                                    <li class="folder"><strong>Layout</strong>: Plantillas (MainLayout).</li>
                                    <li class="folder"><strong>Pages</strong>: Vistas (Home, Counter).</li>
                                    <li>_Imports.razor</li>
                                    <li>App.razor</li>
                                    <li>Routes.razor</li>
                                </ul>
                            </li>
                            <li><strong>appsettings.json</strong>: Cadenas de conexi√≥n a BD.</li>
                            <li><strong>Program.cs</strong>: El punto de entrada.</li>
                        </ul>
                    </div>
                </div>
                <div class="col-md-7">
                    <h4>Archivos Clave:</h4>
                    <dl class="row">
                        <dt class="col-sm-3">Program.cs</dt>
                        <dd class="col-sm-9">Aqu√≠ se configura la Inyecci√≥n de Dependencias, la conexi√≥n a SQL Server y los servicios de Blazor.</dd>

                        <dt class="col-sm-3">App.razor</dt>
                        <dd class="col-sm-9">Es el componente ra√≠z. Define la estructura HTML base y carga el Router.</dd>

                        <dt class="col-sm-3">_Imports.razor</dt>
                        <dd class="col-sm-9">Todo <code>using</code> que pongas aqu√≠ ser√° visible en todos los componentes del proyecto. Evita repetir c√≥digo.</dd>

                        <dt class="col-sm-3">MainLayout.razor</dt>
                        <dd class="col-sm-9">Define el dise√±o compartido (Men√∫ lateral, Pie de p√°gina) que usan todas las p√°ginas.</dd>
                    </dl>
                </div>
            </div>
        </section>

        <!-- Secci√≥n 3: Componentes Razor -->
        <section class="mb-5">
            <h2>3. Componentes Razor (.razor)</h2>
            <p>Un componente en Blazor es una mezcla de <strong>HTML</strong> y l√≥gica <strong>C#</strong>. Se compilan como clases de C#.</p>

            <div class="row">
                <div class="col-lg-6">
                    <div class="code-block">
<pre><code class="language-csharp">@page "/contador"

&lt;h1&gt;Contador: @conteoActual&lt;/h1&gt;

&lt;button class="btn btn-primary" @onclick="Incrementar"&gt;
    Click aqu√≠
&lt;/button&gt;

@code {
    // Esto es C# puro
    private int conteoActual = 0;

    private void Incrementar()
    {
        conteoActual++;
    }
}</code></pre>
                    </div>
                    <p class="text-muted small"><em>Nota: Este ejemplo muestra la reactividad de Blazor. Al presionar el bot√≥n, el servidor incrementa la variable y solo env√≠a el cambio del n√∫mero al navegador.</em></p>
                </div>
                <div class="col-lg-6">
                    <h5>Desglose del C√≥digo:</h5>
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item"><strong>@page "/ruta":</strong> Define c√≥mo llegar a esta p√°gina desde el navegador.</li>
                        <li class="list-group-item"><strong>@variable:</strong> Imprime el valor de C# en el HTML (Data Binding).</li>
                        <li class="list-group-item"><strong>@onclick:</strong> Vincula el evento click del bot√≥n con un m√©todo C#.</li>
                        <li class="list-group-item"><strong>@code { ... }:</strong> Bloque donde escribimos la l√≥gica, variables y m√©todos.</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Secci√≥n 4: Inyecci√≥n de Dependencias -->
        <section class="mb-5">
            <h2>4. Inyecci√≥n de Dependencias (DI)</h2>
            <div class="important-note">
                <strong>Concepto Vital:</strong> En lugar de crear objetos con <code>new Servicio()</code> dentro de los componentes, le pedimos al sistema que nos los d√©. Esto desacopla el c√≥digo.
            </div>

            <div class="row mb-4">
                <div class="col-md-6">
                    <h4>üõ†Ô∏è ¬øQu√© es una Interfaz?</h4>
                    <p>Una <strong>Interfaz</strong> (<code>interface</code>) es un contrato. No contiene la l√≥gica, solo define "qu√©" debe hacer una clase, pero no "c√≥mo" lo hace. En C# se nombran con una 'I' al principio (ej: <code>IEstudianteService</code>).</p>
                </div>
                <div class="col-md-6">
                    <div class="concept-card">
                        <h5>üîó El rol de la Interfaz en DI</h5>
                        <p>Cuando inyectamos dependencias, le pedimos al componente que dependa de la <strong>interfaz</strong> y no de la clase concreta. Esto permite cambiar la implementaci√≥n (ej: de una BD real a una de prueba) sin tocar el c√≥digo del componente.</p>
                    </div>
                </div>
            </div>

            <div class="code-block">
                <h6>Registro en Program.cs:</h6>
<pre><code class="language-csharp">// "Le digo al sistema: Cuando alguien pida IEstudianteService, dale EstudianteService"
builder.Services.AddScoped&lt;IEstudianteService, EstudianteService&gt;();</code></pre>
            </div>
            <p class="text-muted small"><em>Nota: Al usar interfaces, nuestro c√≥digo es mucho m√°s flexible y f√°cil de probar (Testing).</em></p>

            <p class="mt-4">En Blazor Server, el ciclo de vida de los servicios es cr√≠tico porque la memoria est√° en el servidor.</p>

            <table class="table table-bordered table-hover bg-white">
                <thead class="table-dark">
                    <tr>
                        <th>Tiempo de Vida</th>
                        <th>Descripci√≥n</th>
                        <th>Uso Recomendado</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Transient</strong></td>
                        <td>Se crea una instancia nueva cada vez que se solicita.</td>
                        <td>Servicios ligeros sin estado.</td>
                    </tr>
                    <tr>
                        <td><strong>Scoped</strong> <span class="badge bg-danger">¬°Importante!</span></td>
                        <td>Se crea una vez por conexi√≥n de usuario (Circuito SignalR).</td>
                        <td>Repositorios de BD, Servicios de Usuario, Carrito de Compra.</td>
                    </tr>
                    <tr>
                        <td><strong>Singleton</strong></td>
                        <td>Una √∫nica instancia para TODOS los usuarios del servidor.</td>
                        <td>Cach√© global, Configuraci√≥n.</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- Secci√≥n 5: Entity Framework Core -->
        <section class="mb-5">
            <h2>5. Acceso a Datos con EF Core</h2>
            <p><strong>Entity Framework (EF) Core</strong> es el ORM (Object-Relational Mapper) oficial de Microsoft. Permite trabajar con bases de datos usando objetos de C# en lugar de escribir SQL manualmente.</p>

            <div class="row">
                <div class="col-md-6">
                    <div class="concept-card">
                        <h5>üõ°Ô∏è DbContext</h5>
                        <p>Es el coraz√≥n de EF Core. Representa una sesi√≥n con la base de datos y se utiliza para consultar y guardar instancias de tus entidades.</p>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="concept-card">
                        <h5>üöÄ Migraciones</h5>
                        <p>Permiten evolucionar el esquema de la base de datos de forma incremental. Sincronizan tus clases de C# con las tablas de SQL.</p>
                    </div>
                </div>
            </div>

            <div class="code-block">
                <h6>Ejemplo de consulta LINQ en Blazor:</h6>
<pre><code class="language-cs">// Usando Inyecci√≥n de Dependencias para obtener el contexto
var estudiantes = await _context.Estudiantes
    .Where(e => e.Activo)
    .ToListAsync();</code></pre>
            </div>
            <p class="text-muted small"><em>Nota: LINQ traduce este c√≥digo de C# a una consulta SQL optimizada de forma autom√°tica, permiti√©ndonos trabajar con entidades en lugar de strings de texto.</em></p>
        </section>

        <!-- Secci√≥n 6: Autenticaci√≥n y Autorizaci√≥n -->
        <section class="mb-5">
            <h2>6. Seguridad: Identity</h2>
            <p>Blazor utiliza <strong>ASP.NET Core Identity</strong> para gestionar usuarios, contrase√±as, perfiles y roles. En proyectos con "Individual Accounts", esto ya viene pre-configurado.</p>

            <div class="row">
                <div class="col-lg-7">
                    <h5>Componentes de Seguridad:</h5>
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item"><strong>&lt;AuthorizeView&gt;:</strong> Muestra contenido diferente dependiendo de si el usuario est√° logueado o no.</li>
                        <li class="list-group-item"><strong>[Authorize]:</strong> Atributo para proteger p√°ginas enteras, redirigiendo al login si no hay acceso.</li>
                        <li class="list-group-item"><strong>AuthenticationStateProvider:</strong> El servicio que nos dice QUI√âN es el usuario actual en el circuito SignalR.</li>
                    </ul>
                </div>
                <div class="col-lg-5">
                    <div class="code-block">
<pre><code class="language-html">&lt;AuthorizeView&gt;
    &lt;Authorized&gt;
        &lt;p&gt;Hola, @context.User.Identity.Name&lt;/p&gt;
    &lt;/Authorized&gt;
    &lt;NotAuthorized&gt;
        &lt;p&gt;Por favor, inicia sesi√≥n.&lt;/p&gt;
    &lt;/NotAuthorized&gt;
&lt;/AuthorizeView&gt;</code></pre>
                    </div>
                    <p class="text-muted small"><em>Nota: &lt;AuthorizeView&gt; es un componente declarativo que oculta o muestra fragmentos de UI basados en el estado de autenticaci√≥n del usuario sin necesidad de condicionales complejos en C#.</em></p>
                </div>
            </div>
        </section>

        <!-- Conclusi√≥n -->
        <div class="alert alert-success" role="alert">
            <h4 class="alert-heading">Resumen de la Sesi√≥n</h4>
            <p>Hoy exploramos la arquitectura de <strong>Blazor Server</strong>, comprendiendo c√≥mo la renderizaci√≥n en el servidor y el uso de <strong>SignalR</strong> permiten aplicaciones web interactivas y fluidas usando C#. Analizamos la <strong>anatom√≠a de un proyecto .NET 8</strong> y la versatilidad de los <strong>componentes Razor</strong> que unen l√≥gica y dise√±o.</p>
            <p>Profundizamos en conceptos avanzados de arquitectura como el uso de <strong>Interfaces</strong> para lograr un c√≥digo desacoplado y mantenible a trav√©s de la <strong>Inyecci√≥n de Dependencias (DI)</strong>. Finalmente, introdujimos <strong>Entity Framework Core</strong> como nuestro motor de acceso a datos y <strong>ASP.NET Core Identity</strong> como la soluci√≥n robusta para gestionar la autenticaci√≥n y seguridad de nuestros usuarios.</p>
            <hr>
            <p class="mb-0"><strong>Siguiente paso:</strong> En el laboratorio configuraremos nuestro entorno de desarrollo y crearemos una soluci√≥n completa que integre todos estos pilares.</p>
        </div>

    </div>

    <footer>
        <div class="container">
            <p>Universidad Tecnol√≥gica del Cibao Oriental (UTECO)</p>
            <p><strong>Maestro:</strong> Felix R. Benzan | <a href="https://www.felixbenzan.com.do" class="text-white">www.felixbenzan.com.do</a></p>
        </div>
    </footer>

    <script>
        mermaid.initialize({ startOnLoad: true, theme: 'neutral' });
    </script>
</body>
</html>